/*! For license information please see bf-engine.js.LICENSE.txt */
(()=>{var e={702:function(e,t,n){e.exports=function(){"use strict";function e(e){return"function"==typeof e||"object"==typeof e&&null!==e}function t(e){return"function"==typeof e}var r=Array.isArray?Array.isArray:function(e){return"[object Array]"===Object.prototype.toString.call(e)},o=0,i=void 0,s=void 0,a=function(e,t){v[o]=e,v[o+1]=t,2===(o+=2)&&(s?s(b):S())};function c(e){s=e}function l(e){a=e}var d="undefined"!=typeof window?window:void 0,u=d||{},h=u.MutationObserver||u.WebKitMutationObserver,p="undefined"==typeof self&&"undefined"!=typeof process&&"[object process]"==={}.toString.call(process),f="undefined"!=typeof Uint8ClampedArray&&"undefined"!=typeof importScripts&&"undefined"!=typeof MessageChannel;function g(){return function(){return process.nextTick(b)}}function y(){return function(){i(b)}}function m(){var e=0,t=new h(b),n=document.createTextNode("");return t.observe(n,{characterData:!0}),function(){n.data=e=++e%2}}function k(){var e=new MessageChannel;return e.port1.onmessage=b,function(){return e.port2.postMessage(0)}}function w(){var e=setTimeout;return function(){return e(b,1)}}var v=new Array(1e3);function b(){for(var e=0;e<o;e+=2)(0,v[e])(v[e+1]),v[e]=void 0,v[e+1]=void 0;o=0}function _(){try{var e=n(327);return i=e.runOnLoop||e.runOnContext,y()}catch(e){return w()}}var S=void 0;function A(e,t){var n=arguments,r=this,o=new this.constructor(E);void 0===o[I]&&X(o);var i,s=r._state;return s?(i=n[s-1],a((function(){return Y(s,o,i,r._result)}))):W(r,o,e,t),o}function C(e){var t=this;if(e&&"object"==typeof e&&e.constructor===t)return e;var n=new t(E);return $(n,e),n}S=p?g():h?m():f?k():void 0===d?_():w();var I=Math.random().toString(36).substring(16);function E(){}var P=void 0,x=1,O=2,T=new q;function L(){return new TypeError("You cannot resolve a promise with itself")}function B(){return new TypeError("A promises callback cannot return that same promise.")}function F(e){try{return e.then}catch(e){return T.error=e,T}}function K(e,t,n,r){try{e.call(t,n,r)}catch(e){return e}}function j(e,t,n){a((function(e){var r=!1,o=K(n,t,(function(n){r||(r=!0,t!==n?$(e,n):U(e,n))}),(function(t){r||(r=!0,N(e,t))}),"Settle: "+(e._label||" unknown promise"));!r&&o&&(r=!0,N(e,o))}),e)}function D(e,t){t._state===x?U(e,t._result):t._state===O?N(e,t._result):W(t,void 0,(function(t){return $(e,t)}),(function(t){return N(e,t)}))}function M(e,n,r){n.constructor===e.constructor&&r===A&&n.constructor.resolve===C?D(e,n):r===T?N(e,T.error):void 0===r?U(e,n):t(r)?j(e,n,r):U(e,n)}function $(t,n){t===n?N(t,L()):e(n)?M(t,n,F(n)):U(t,n)}function R(e){e._onerror&&e._onerror(e._result),H(e)}function U(e,t){e._state===P&&(e._result=t,e._state=x,0!==e._subscribers.length&&a(H,e))}function N(e,t){e._state===P&&(e._state=O,e._result=t,a(R,e))}function W(e,t,n,r){var o=e._subscribers,i=o.length;e._onerror=null,o[i]=t,o[i+x]=n,o[i+O]=r,0===i&&e._state&&a(H,e)}function H(e){var t=e._subscribers,n=e._state;if(0!==t.length){for(var r=void 0,o=void 0,i=e._result,s=0;s<t.length;s+=3)r=t[s],o=t[s+n],r?Y(n,r,o,i):o(i);e._subscribers.length=0}}function q(){this.error=null}var z=new q;function V(e,t){try{return e(t)}catch(e){return z.error=e,z}}function Y(e,n,r,o){var i=t(r),s=void 0,a=void 0,c=void 0,l=void 0;if(i){if((s=V(r,o))===z?(l=!0,a=s.error,s=null):c=!0,n===s)return void N(n,B())}else s=o,c=!0;n._state!==P||(i&&c?$(n,s):l?N(n,a):e===x?U(n,s):e===O&&N(n,s))}function G(e,t){try{t((function(t){$(e,t)}),(function(t){N(e,t)}))}catch(t){N(e,t)}}var Q=0;function J(){return Q++}function X(e){e[I]=Q++,e._state=void 0,e._result=void 0,e._subscribers=[]}function Z(e,t){this._instanceConstructor=e,this.promise=new e(E),this.promise[I]||X(this.promise),r(t)?(this._input=t,this.length=t.length,this._remaining=t.length,this._result=new Array(this.length),0===this.length?U(this.promise,this._result):(this.length=this.length||0,this._enumerate(),0===this._remaining&&U(this.promise,this._result))):N(this.promise,ee())}function ee(){return new Error("Array Methods must be provided an Array")}function te(e){return new Z(this,e).promise}function ne(e){var t=this;return r(e)?new t((function(n,r){for(var o=e.length,i=0;i<o;i++)t.resolve(e[i]).then(n,r)})):new t((function(e,t){return t(new TypeError("You must pass an array to race."))}))}function re(e){var t=new this(E);return N(t,e),t}function oe(){throw new TypeError("You must pass a resolver function as the first argument to the promise constructor")}function ie(){throw new TypeError("Failed to construct 'Promise': Please use the 'new' operator, this object constructor cannot be called as a function.")}function se(e){this[I]=J(),this._result=this._state=void 0,this._subscribers=[],E!==e&&("function"!=typeof e&&oe(),this instanceof se?G(this,e):ie())}function ae(){var e=void 0;if(void 0!==n.g)e=n.g;else if("undefined"!=typeof self)e=self;else try{e=Function("return this")()}catch(e){throw new Error("polyfill failed because global object is unavailable in this environment")}var t=e.Promise;if(t){var r=null;try{r=Object.prototype.toString.call(t.resolve())}catch(e){}if("[object Promise]"===r&&!t.cast)return}e.Promise=se}return Z.prototype._enumerate=function(){for(var e=this.length,t=this._input,n=0;this._state===P&&n<e;n++)this._eachEntry(t[n],n)},Z.prototype._eachEntry=function(e,t){var n=this._instanceConstructor,r=n.resolve;if(r===C){var o=F(e);if(o===A&&e._state!==P)this._settledAt(e._state,t,e._result);else if("function"!=typeof o)this._remaining--,this._result[t]=e;else if(n===se){var i=new n(E);M(i,e,o),this._willSettleAt(i,t)}else this._willSettleAt(new n((function(t){return t(e)})),t)}else this._willSettleAt(r(e),t)},Z.prototype._settledAt=function(e,t,n){var r=this.promise;r._state===P&&(this._remaining--,e===O?N(r,n):this._result[t]=n),0===this._remaining&&U(r,this._result)},Z.prototype._willSettleAt=function(e,t){var n=this;W(e,void 0,(function(e){return n._settledAt(x,t,e)}),(function(e){return n._settledAt(O,t,e)}))},se.all=te,se.race=ne,se.resolve=C,se.reject=re,se._setScheduler=c,se._setAsap=l,se._asap=a,se.prototype={constructor:se,then:A,catch:function(e){return this.then(null,e)}},ae(),se.polyfill=ae,se.Promise=se,se}()},327:()=>{}},t={};function n(r){var o=t[r];if(void 0!==o)return o.exports;var i=t[r]={exports:{}};return e[r].call(i.exports,i,i.exports,n),i.exports}n.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),(()=>{"use strict";var e,t=n(702);!function(e){e.LINK="link",e.SCRIPT="script",e.DIV="div",e.IFRAME="iframe"}(e||(e={}));class r{openOverlayWhenCookiesNotAllowed(){if(!window.navigator.cookieEnabled){const t=document.createElement(e.DIV);for(const e in this.backdropStyles)t.style[e]=this.backdropStyles[e];t.insertAdjacentHTML("afterbegin",this.dialogHtmlAsString),window.onload=()=>{document.body.appendChild(t),document.getElementById("bfl-browser-check-cookie-dialog-close").addEventListener("click",(()=>{document.body.removeChild(t)}))}}}get dialogHtmlAsString(){return'\n      <div style="padding: 24px; background-color: white; box-shadow: 0 11px 15px -7px rgba(0,0,0,.2), 0 24px 38px 3px rgba(0,0,0,.14), 0 9px 46px 8px rgba(0,0,0,.12)"> \n          <h1>Cookies deaktiviert</h1> \n          <div>Folgende Funktionen laufen deswegen nicht wunschgemäss:</div> \n          <br> \n          <b>- Login Kundencenter</b><br> \n          <b>- Sprachauswahl</b><br> \n          <br> \n          <div>Wenn Sie diese Funktionen nutzen möchten, aktivieren Sie bitte Ihre Cookies in den Browsereinstellungen.</div> \n              <div style="display: flex; justify-content: flex-end; margin-top: 24px"> \n              <div id="bfl-browser-check-cookie-dialog-close" style="background-color: #0080C6; color: white; padding: 24px; font-size: 18px; cursor: pointer">Schliessen</div> \n          </div> \n      </div>\n        '}get backdropStyles(){return{position:"fixed",top:"0",left:"0",width:"100%",height:"100%",display:"flex",justifyContent:"center",alignItems:"center",zIndex:"9999",backgroundColor:"rgba(0, 0, 0, 0.5)"}}}const o="/bf-engine.js";class i{static get currentScriptUrl(){const t=document.getElementsByTagName(e.SCRIPT);return Array.from(t).find((e=>e.src.includes(o))).src.replace(o,"")}static getStagedDomain(e,t="bkw.ch"){return`${{p:"",q:"-q",t:"-t",local:"-t"}[e]}.${t}`}mergeDeep(e,t){for(let n in t)t[n]&&"object"==typeof t[n]&&e[n]&&"object"==typeof e[n]?this.mergeDeep(e[n],t[n]):(t.hasOwnProperty(n)&&void 0!==t[n]||null===t[n])&&(e[n]=t[n]);return e}}class s{static loadThemeStyle(e){s.loadStyle(`${i.currentScriptUrl}/themes/${e}/theme-definition.css`)}static loadStyle(t){const n=document.createElement(e.LINK);n.rel="stylesheet",n.type="text/css",n.href=t,n.media="all",document.head.appendChild(n)}static loadFavIcon(t,n){const r=document.createElement(e.LINK);r.rel="shortcut icon",r.type="image/x-icon",r.href=`https://static${i.getStagedDomain(n)}/bf-assets/1.x.x/${t}/favicon/default.png`,document.head.appendChild(r)}}class a{constructor(e){this.languages=e}load(){this.setLanguage(this.languages),s.loadStyle(`${i.currentScriptUrl}/styles/cookiebot.css`),this.loadCookieBannerScript()}setLanguage(e){var t;this.language=(null===(t=document.cookie.match("(^|;)\\s*BKW_OP_USER_LANGUAGE\\s*=\\s*([^;]+)"))||void 0===t?void 0:t.pop())||"",this.language||(this.language=[].concat.apply([],["languages","language","browserLanguage","userLanguage","systemLanguage"].map((e=>window.navigator[e]))).filter((e=>!!e)).map((e=>e.substr(0,2).toLowerCase())).find((t=>e.some((e=>t===e)))))}loadCookieBannerScript(){const t=document.createElement(e.SCRIPT);t.type="text/javascript",t.id="Cookiebot",t.src="https://consent.cookiebot.com/uc.js",t.setAttribute("data-cbid","33f043e6-81b1-4ece-9885-10229f61fa53"),t.setAttribute("data-culture",this.language),t.async=!0;const n=document.getElementsByTagName(e.SCRIPT)[0];n.parentNode.insertBefore(t,n)}}class c{static throwError(e){throw new Error(`${c.scriptname}: ${e}`)}static logError(e){console.error(`${c.scriptname}: ${e}`)}}c.scriptname="bf-engine";class l{static loadScript(t,n={},r=!1){const o=document.createElement(e.SCRIPT);o.src=t,o.onerror=()=>{c.logError(`Could not load script ${t}`)},o.async=!1,Object.assign(o,n),r?window.onload=()=>{document.head.insertBefore(o,document.head.firstChild)}:document.head.append(o)}}const d={loadStyles:!0,unsupportedBrowserRedirectUrl:"https://www.bkw.ch/en/unsupported-browser",authPage:null,environment:{realm:"oneportal",stage:void 0,theme:void 0,languages:void 0},loadFavicon:!0,keycloak:!1,scripts:[],loadCookiebot:!0};class u{constructor(e){this._options=e,this.onKeycloakScriptLoaded.bind(this)}loadKeycloak(){return new Promise((e=>this._options.keycloak?this.authPage?this.initKeycloakByIFrame().then((()=>{window.bflKeycloak||(window.bflKeycloak=new Promise((e=>{window.bflKeycloakResolve=e}))),window.bflKeycloakLoginIFrameWindow=window,e()})):this.initKeycloak().then((()=>(this.onKeycloakScriptLoaded(),this._keycloakAdapter.init({onLoad:this.keycloakOnLoad,checkLoginIframe:!1}).then((()=>{e()}))))):e()))}get keycloakAdapter(){return this._keycloakAdapter}set keycloakAdapter(e){this._keycloakAdapter=e}get authenticatedAsync(){return this._authenticatedAsync}get authenticatedAsyncResolve(){return this._authenticatedAsyncResolve}initKeycloak(){return new Promise((e=>{l.loadScript(this.keycloakScriptUrl,{async:!0,onload:e},!0)}))}initKeycloakByIFrame(){return new Promise((e=>(window.bflKeycloakConfig=this.keycloakConfig,window.bfEngine.authenticatedAsync||(this._authenticatedAsync=new Promise((e=>{this._authenticatedAsyncResolve=e}))),this.createAuthPageIFrame().then(e))))}createAuthPageIFrame(){return new Promise((t=>{const n=document.createElement(e.IFRAME);n.style.position="absolute",n.style.width="0",n.style.height="0",n.src=this.authPage,document.head.appendChild(n),window.bflKeycloakLoginIFrameWindow=n.contentWindow,window.bflKeycloakLoginIFrameWindow===n.contentWindow&&t()}))}onKeycloakScriptLoaded(){const e=new window.Keycloak(this.keycloakConfig);this._keycloakAdapter=e,window.bflKeycloakConfig=this.keycloakConfig}get keycloakConfig(){return{url:`https://login${i.getStagedDomain(this.environment.stage,this.domain)}/auth`,realm:this.environment.realm,theme:this.environment.theme,clientId:this.clientId}}get keycloakOnLoad(){return this.keycloakOptions.loginRequired?"login-required":"check-sso"}get clientId(){if(!this.keycloakOptions.clientIdPerDomain)return this.keycloakOptions.clientId;Array.isArray(this.keycloakOptions.clientIdPerDomain)||c.throwError("clientIdsPerDomain is not an array");const e=this.keycloakOptions.clientIdPerDomain.find((e=>e.domain===this.domainFromHostname));return(null==e?void 0:e.clientId)||this.keycloakOptions.clientId}get domain(){return"home-energy"===this.environment.realm?`${this.environment.realm}.ch`:"portal-services.ch"}get domainFromHostname(){return window.location.hostname.split(".").slice(-2).join(".")}get environment(){return this._options.environment}get keycloakOptions(){return this._options.keycloak}get authPage(){return this._options.authPage}get keycloakScriptUrl(){return`${this.keycloakConfig.url}/js/keycloak.js`}}const h="bfe-easteregg";class p{loadOnlyIfClientIdIsMyBKW(e,t){if("mybkw"!==e)return;const n=`https://static${i.getStagedDomain(t)}/bfe-easteregg/1.x.x/bfe-easteregg.js`;l.loadScript(n),this.addToDOMIfNotPresent()}addToDOMIfNotPresent(){this.isTagAlreadyPresentInDOM||document.body.appendChild(document.createElement(h))}get isTagAlreadyPresentInDOM(){return document.body.getElementsByTagName(h).length>0}}var f=/Edge?\/(1[6-9]|[2-9]\d|\d{3,})(\.\d+|)(\.\d+|)|Firefox\/([6-9]\d|\d{3,})\.\d+(\.\d+|)|Chrom(ium|e)\/(6[1-9]|[7-9]\d|\d{3,})\.\d+(\.\d+|)([\d.]+$|.*Safari\/(?![\d.]+ Edge\/[\d.]+$))|Maci.+ Version\/(10\.([1-9]|\d{2,})|(1[1-9]|[2-9]\d|\d{3,})\.\d+)([,.]\d+|)( Mobile\/\w+|) Safari\/|Chrome.+OPR\/(4[89]|[5-9]\d|\d{3,})\.\d+\.\d+|(CPU[ +]OS|iPhone[ +]OS|CPU[ +]iPhone|CPU IPhone OS|CPU iPad OS)[ +]+(10[._]([3-9]|\d{2,})|(1[1-9]|[2-9]\d|\d{3,})[._]\d+)([._]\d+|)|Android:?[ /-](109|1[1-9]\d|[2-9]\d{2}|\d{4,})(\.\d+|)(\.\d+|)|Mobile Safari.+OPR\/(7[3-9]|[89]\d|\d{3,})\.\d+\.\d+|Android.+Firefox\/(109|1[1-9]\d|[2-9]\d{2}|\d{4,})\.\d+(\.\d+|)|Android.+Chrom(ium|e)\/(109|1[1-9]\d|[2-9]\d{2}|\d{4,})\.\d+(\.\d+|)|Android.+(UC? ?Browser|UCWEB|U3)[ /]?(13\.([4-9]|\d{2,})|(1[4-9]|[2-9]\d|\d{3,})\.\d+)\.\d+|SamsungBrowser\/(8\.([2-9]|\d{2,})|(9|\d{2,})\.\d+)|Android.+MQ{2}Browser\/(13(\.([1-9]|\d{2,})|)|(1[4-9]|[2-9]\d|\d{3,})(\.\d+|))(\.\d+|)|baidubrowser[\s/](13(\.(1[89]|[2-9]\d|\d{3,})|)|(1[4-9]|[2-9]\d|\d{3,})(\.\d+|))(\.\d+|)/;class g{redirectWhenBrowserIsNotSupported(e){this.isBrowserSupported||(window.location.href=e)}get isBrowserSupported(){return f.test(this.currentBrowser)}get currentBrowser(){return`${navigator.userAgent}`}}class y{static validateEngineOptions(e){return e.environment||c.throwError("Environment is not defined"),e.environment.realm||c.throwError("Realm is not defined"),e.environment.stage||c.throwError("Stage is not defined"),-1===["p","q","t","local"].indexOf(e.environment.stage)&&c.throwError("Stage is not valid"),e.environment.theme||c.throwError("Theme is not defined"),e.environment||0!==e.environment.languages.length||c.throwError("No language was defined"),Array.isArray(e.scripts)||c.throwError("Scripts is not an array"),e.keycloak&&(e.keycloak.clientId||e.keycloak.clientIdPerDomain||c.throwError("Keycloak clientId is not defined")),!0}}(0,t.polyfill)(),window.bfEngine=new class{start(e){this.checkIfAlreadyStarted(),this.engineHelper=new i,this._options=this.engineHelper.mergeDeep(d,e),this.cookiebot=new a(this.options.environment.languages),this.browserChecker=new g,this.cookieChecker=new r,this.keycloakLoader=new u(this.options),this.easteregg=new p,y.validateEngineOptions(this.options),this.themeFallbackStrategy(),this.realmFallbackStrategy(),this.browserChecker.redirectWhenBrowserIsNotSupported(this.options.unsupportedBrowserRedirectUrl),this.cookieChecker.openOverlayWhenCookiesNotAllowed(),this.options.loadCookiebot&&this.cookiebot.load(),this.options.loadFavicon&&s.loadFavIcon(this.currentTheme,this.currentStage),this.keycloakLoader.loadKeycloak().then((()=>{this.prependPolyfillstoScripts(),this.options.loadStyles&&s.loadThemeStyle(this.currentTheme),this.addScriptsToDOM(),this.easteregg.loadOnlyIfClientIdIsMyBKW(this.keycloakLoader.keycloakConfig.clientId,this.currentStage)})),this._isStarted=!0}checkIfAlreadyStarted(){this.started&&c.throwError("Engine is already started")}prependPolyfillstoScripts(){this.browserChecker.isBrowserSupported?this.options.scripts.unshift(`${i.currentScriptUrl}/polyfills-modern.js`):c.throwError(`Cannot load polyfills for browsertype: ${this.browserChecker.currentBrowser}`)}addScriptsToDOM(){for(const e of this.options.scripts)l.loadScript(e)}themeFallbackStrategy(){this.options.environment.theme||!this.options.loadFavicon&&!this.options.loadStyles||(c.logError("Theme is not defined but styles or favicon are loaded. Using default theme 'bkw'"),this.options.environment.theme="bkw")}realmFallbackStrategy(){"bkw"===this.options.environment.realm&&(this.options.environment.realm="oneportal")}get selfService(){return{url:`https://api-op-self-service${i.getStagedDomain(this.options.environment.stage)}`}}get started(){return this._isStarted}get keycloakAdapter(){return this.keycloakLoader.keycloakAdapter}set keycloakAdapter(e){this.keycloakLoader.keycloakAdapter=e}get authenticatedAsync(){return this.keycloakLoader.authenticatedAsync}get authenticatedAsyncResolve(){return this.keycloakLoader.authenticatedAsyncResolve}get options(){return this._options}get currentTheme(){return this.options.environment.theme}get currentStage(){return this.options.environment.stage}}})()})();